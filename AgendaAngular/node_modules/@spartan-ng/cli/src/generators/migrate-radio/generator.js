"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.migrateRadioGenerator = migrateRadioGenerator;
const devkit_1 = require("@nx/devkit");
const visit_files_1 = require("../../utils/visit-files");
async function migrateRadioGenerator(tree, { skipFormat }) {
    updateImports(tree);
    replaceSelector(tree);
    if (!skipFormat) {
        await (0, devkit_1.formatFiles)(tree);
    }
}
function replaceSelector(tree) {
    // if the element is `<brn-radio hlm` then we need to replace it with `<hlm-radio`
    // we also need to replace the closing tag `</brn-radio>` with `</hlm-radio>`
    (0, visit_files_1.visitFiles)(tree, '.', (path) => {
        // if this is not an html file or typescript file (inline templates) then skip
        if (!path.endsWith('.html') && !path.endsWith('.ts')) {
            return;
        }
        let content = tree.read(path, 'utf-8');
        if (!content) {
            return;
        }
        content = content.replace(/<brn-radio hlm/g, '<hlm-radio');
        content = content.replace(/<\/brn-radio>/g, '</hlm-radio>');
        tree.write(path, content);
    });
}
/**
 * Update imports remove BrnRadioComponent import and replace HlmRadioDirective with HlmRadioComponent
 */
function updateImports(tree) {
    (0, visit_files_1.visitFiles)(tree, '/', (path) => {
        const content = tree.read(path).toString('utf-8');
        if (content.includes('@spartan-ng/brain/radio-group') || content.includes('@spartan-ng/ui-radiogroup-helm')) {
            const updatedContent = content
                // Handle `import { BrnRadioComponent } from '@spartan-ng/brain/radio-group';`
                .replace("import { BrnRadioComponent } from '@spartan-ng/brain/radio-group';", '')
                // Remove `BrnRadioComponent` with optional comma and whitespace
                .replace(/BrnRadioComponent,?\s?/, '')
                // Replace all `HlmRadioDirective` with `HlmRadioComponent`
                .replaceAll('HlmRadioDirective', 'HlmRadioComponent');
            tree.write(path, updatedContent);
        }
    });
}
exports.default = migrateRadioGenerator;
//# sourceMappingURL=generator.js.map